<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AR Treasure Chest">
    <meta name="theme-color" content="#FF8A00">
    <title>AR Treasure Chest Experience</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="arjs-loader">
        <div>Loading AR experience...<br>Please allow camera access</div>
    </div>
    
    <div id="ui-container">
        <div id="instructions">Click 'Scan Surface' to begin</div>
        <button id="scan-button">SCAN SURFACE</button>
        <button id="place-button">PLACE CHEST</button>
        <button id="open-button">OPEN TREASURE</button>
        <div id="reward-display">
            <img id="reward-image" src="" alt="Your Reward">
            <div id="reward-title">Congratulations!</div>
            <div id="reward-description">You've found a special reward!</div>
            <button id="close-reward">Continue Exploring</button>
        </div>
    </div>
    
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; antialias: true; precision: mediump; maxCanvasWidth: 1920; maxCanvasHeight: 1080;"
        audio>
        
        <!-- Audio elements -->
        <audio id="open-sound" src="audio/open-chest.mp3" preload="auto"></audio>
        <audio id="close-sound" src="audio/close-chest.mp3" preload="auto"></audio>
        <audio id="reward-sound" src="audio/reward-reveal.mp3" preload="auto"></audio>
        
        <!-- Camera with hit test for markerless AR -->
        <a-entity id="ar-camera" camera="active: true" look-controls position="0 0 0"></a-entity>
        
        <!-- Lighting -->
        <a-entity light="type: ambient; intensity: 0.8;"></a-entity>
        <a-entity light="type: directional; intensity: 0.6; castShadow: true;" position="-1 2 2"></a-entity>
        
        <!-- Treasure Chest Template -->
        <a-assets>
            <a-asset-item id="chest-model" src="models/chest.glb"></a-asset-item>
        </a-assets>
        
        <!-- Ground detection plane -->
        <a-entity id="ground-plane" 
                  geometry="primitive: plane; width: 100; height: 100" 
                  rotation="-90 0 0" 
                  material="visible: false"
                  static-body>
        </a-entity>
        
        <!-- Treasure Chest Container -->
        <a-entity id="chest-container" position="0 0 -2">
            <!-- Chest Model -->
            <a-entity id="treasure-chest" 
                      gltf-model="#chest-model"
                      scale="0.5 0.5 0.5"
                      position="0 0 0"
                      animation-mixer>
            </a-entity>
        </a-entity>
    </a-scene>
    
    <script src="js/app.js"></script>
</body>
</html>